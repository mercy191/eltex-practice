root@eltex-practice2-pg2-v9:~# vi template_task.sh
#!/bin/bash

# Report file name
SCRIPT_NAME=$(basename "$0")
LOG_FILE="report_${SCRIPT_NAME}.log"

if [ ! -f "$LOG_FILE" ]; then
    touch "$LOG_FILE"
    echo "$LOG_FILE создан" >> "$LOG_FILE"
fi

# PID, date and time
PID=$$
DATE_TIME=$(date "+%Y-%m-%d %H:%M:%S")

# Add start message in log
echo "[$PID] $DATE_TIME Скрипт запущен" >> "$LOG_FILE"

# Generate random number
SLEEP_TIME=$((RANDOM % 1771 + 30))

# Sleep
sleep $SLEEP_TIME

# Date, time and duration
DATE_TIME_END=$(date "+%Y-%m-%d %H:%M:%S")
DURATION=$((SLEEP_TIME / 60))

# Add end message in log
echo "[$PID] $DATE_TIME_END Скрипт завершился, работал $DURATION минут" >> "$LOG_FILE"

exit 0

root@eltex-practice2-pg2-v9:~# vi observer.sh

#!/bin/bash

# Path to log and conf file
CONF_FILE="observer.conf"
LOG_FILE="observer.log"

if [[ ! -f "$CONF_FILE" ]]; then
  echo "Конфигурационный файл не найден: $CONF_FILE"
  exit 1
fi

if [[ ! -f "$LOG_FILE" ]]; then
  touch "$LOG_FILE"
  echo "$LOG_FILE создан" >> "$LOG_FILE"
fi

# Read conf file
while IFS= read -r script; do

        # Checking script in the list of working process
        if ! pgrep -fx "$script" > /dev/null; then
                nohup bash "$script" > /dev/null 2>&1 &
                echo "$(date '+%Y-%m-%d %H:%M:%S') - Скрипт $script был перезапущен" >> "$LOG_FILE"
        fi

done < "$CONF_FILE"

root@eltex-practice2-pg2-v9:~# chmod +x ~/observer.sh
root@eltex-practice2-pg2-v9:~# crontab -e
* * * * * ~/observer.sh
root@eltex-practice2-pg2-v9:~# cp template_task.sh task1.sh
root@eltex-practice2-pg2-v9:~# cp template_task.sh task2.sh
root@eltex-practice2-pg2-v9:~# cp template_task.sh task3.sh
root@eltex-practice2-pg2-v9:~# cp template_task.sh task4.sh
root@eltex-practice2-pg2-v9:~# cp template_task.sh task5.sh
root@eltex-practice2-pg2-v9:~# chmod +x task1.sh task2.sh task3.sh task4.sh task5.sh
root@eltex-practice2-pg2-v9:~# echo "task1.sh" >> observer.conf
root@eltex-practice2-pg2-v9:~# echo "task2.sh" >> observer.conf
root@eltex-practice2-pg2-v9:~# echo "task3.sh" >> observer.conf
root@eltex-practice2-pg2-v9:~# echo "task4.sh" >> observer.conf
root@eltex-practice2-pg2-v9:~# echo "task5.sh" >> observer.conf

root@eltex-practice2-pg2-v9:~# cat report_task1.sh.log 
[33539] 2025-03-19 14:16:18 Скрипт завершился, работал 1 минут
[33634] 2025-03-19 14:17:01 Скрипт запущен
[33691] 2025-03-19 14:18:01 Скрипт запущен
[33725] 2025-03-19 14:19:01 Скрипт запущен
[33897] 2025-03-19 14:20:01 Скрипт запущен
[33955] 2025-03-19 14:21:01 Скрипт запущен
[33989] 2025-03-19 14:22:01 Скрипт запущен
[34023] 2025-03-19 14:23:01 Скрипт запущен
[34057] 2025-03-19 14:24:01 Скрипт запущен
[34023] 2025-03-19 14:25:00 Скрипт завершился, работал 1 минут
[34107] 2025-03-19 14:25:01 Скрипт запущен
[34148] 2025-03-19 14:26:01 Скрипт запущен

root@eltex-practice2-pg2-v9:~# cat report_task2.sh.log 
report_task2.sh.log создан
[33640] 2025-03-19 14:17:01 Скрипт запущен
[33697] 2025-03-19 14:18:01 Скрипт запущен
[33731] 2025-03-19 14:19:01 Скрипт запущен
[33546] 2025-03-19 14:19:09 Скрипт завершился, работал 3 минут
[33903] 2025-03-19 14:20:01 Скрипт запущен
[33961] 2025-03-19 14:21:01 Скрипт запущен
[33995] 2025-03-19 14:22:01 Скрипт запущен
[33731] 2025-03-19 14:22:20 Скрипт завершился, работал 3 минут
[34029] 2025-03-19 14:23:01 Скрипт запущен
[34063] 2025-03-19 14:24:01 Скрипт запущен
[34112] 2025-03-19 14:25:01 Скрипт запущен
[34154] 2025-03-19 14:26:01 Скрипт запущен
[34215] 2025-03-19 14:27:01 Скрипт запущен

root@eltex-practice2-pg2-v9:~# cat report_task3.sh.log 
report_task3.sh.log создан
[33647] 2025-03-19 14:17:01 Скрипт запущен
[33703] 2025-03-19 14:18:01 Скрипт запущен
[33737] 2025-03-19 14:19:01 Скрипт запущен
[33909] 2025-03-19 14:20:01 Скрипт запущен
[33703] 2025-03-19 14:20:47 Скрипт завершился, работал 2 минут
[33967] 2025-03-19 14:21:01 Скрипт запущен
[34001] 2025-03-19 14:22:01 Скрипт запущен
[34035] 2025-03-19 14:23:01 Скрипт запущен
[34069] 2025-03-19 14:24:01 Скрипт запущен
[34118] 2025-03-19 14:25:01 Скрипт запущен
[34035] 2025-03-19 14:25:32 Скрипт завершился, работал 2 минут
[34160] 2025-03-19 14:26:01 Скрипт запущен
[34221] 2025-03-19 14:27:01 Скрипт запущен

root@eltex-practice2-pg2-v9:~# cat report_task4.sh.log 
report_task4.sh.log создан
[33654] 2025-03-19 14:17:01 Скрипт запущен
[33709] 2025-03-19 14:18:01 Скрипт запущен
[33743] 2025-03-19 14:19:01 Скрипт запущен
[33915] 2025-03-19 14:20:01 Скрипт запущен
[33973] 2025-03-19 14:21:01 Скрипт запущен
[33915] 2025-03-19 14:21:43 Скрипт завершился, работал 1 минут
[34007] 2025-03-19 14:22:01 Скрипт запущен
[34041] 2025-03-19 14:23:01 Скрипт запущен
[34075] 2025-03-19 14:24:01 Скрипт запущен
[34124] 2025-03-19 14:25:01 Скрипт запущен
[34166] 2025-03-19 14:26:01 Скрипт запущен
[34041] 2025-03-19 14:26:45 Скрипт завершился, работал 3 минут
[34227] 2025-03-19 14:27:01 Скрипт запущен
[34265] 2025-03-19 14:28:01 Скрипт запущен

root@eltex-practice2-pg2-v9:~# cat report_task5.sh.log 
report_task5.sh.log создан
[33661] 2025-03-19 14:17:01 Скрипт запущен
[33715] 2025-03-19 14:18:01 Скрипт запущен
[33567] 2025-03-19 14:18:58 Скрипт завершился, работал 3 минут
[33749] 2025-03-19 14:19:01 Скрипт запущен
[33921] 2025-03-19 14:20:01 Скрипт запущен
[33979] 2025-03-19 14:21:01 Скрипт запущен
[34013] 2025-03-19 14:22:01 Скрипт запущен
[34047] 2025-03-19 14:23:01 Скрипт запущен
[34081] 2025-03-19 14:24:01 Скрипт запущен
[34130] 2025-03-19 14:25:01 Скрипт запущен
[33661] 2025-03-19 14:25:53 Скрипт завершился, работал 8 минут
[34172] 2025-03-19 14:26:01 Скрипт запущен
[34233] 2025-03-19 14:27:01 Скрипт запущен
[33921] 2025-03-19 14:27:27 Скрипт завершился, работал 7 минут
[34271] 2025-03-19 14:28:01 Скрипт запущен
[34233] 2025-03-19 14:28:43 Скрипт завершился, работал 1 минут
[34172] 2025-03-19 14:28:47 Скрипт завершился, работал 2 минут

root@eltex-practice2-pg2-v9:~# cat observer.log
observer.log создан
2025-03-19 14:17:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:17:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:17:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:17:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:17:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:18:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:18:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:18:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:18:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:18:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:19:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:19:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:19:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:19:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:19:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:20:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:20:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:20:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:20:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:20:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:21:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:21:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:21:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:21:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:21:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:22:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:22:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:22:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:22:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:22:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:23:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:23:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:23:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:23:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:23:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:24:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:24:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:24:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:24:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:24:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:25:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:25:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:25:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:25:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:25:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:26:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:26:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:26:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:26:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:26:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:27:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:27:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:27:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:27:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:27:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:28:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:28:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:28:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:28:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:28:01 - Скрипт task5.sh был перезапущен
2025-03-19 14:29:01 - Скрипт task1.sh был перезапущен
2025-03-19 14:29:01 - Скрипт task2.sh был перезапущен
2025-03-19 14:29:01 - Скрипт task3.sh был перезапущен
2025-03-19 14:29:01 - Скрипт task4.sh был перезапущен
2025-03-19 14:29:01 - Скрипт task5.sh был перезапущен
